<!DOCTYPE html>
<html lang="en">
<head>
    <title>Command Example</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/xterm/3.8.0/xterm.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xterm/3.8.0/xterm.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xterm/3.8.0/addons/attach/attach.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xterm/3.8.0/addons/fit/fit.min.js"></script>
</head>
<body>
<div id="terminal-container"></div>
<script>

    var conn, term;
    var terminalContainer = document.getElementById('terminal-container');
    createTerminal();

    function createTerminal() {
        // FIXME: that's strange.. when you use cdn, you got global var? ...
        Terminal.applyAddon(attach);
        Terminal.applyAddon(fit);
        term = new Terminal({
            // cursorBlink: true,
            // screenKeys: true,
            // /* Initial terminal size to match the session originator's terminal */
            // cols: 100,
            // rows: 30,
        });
        conn = new WebSocket("ws://" + document.location.host + "/api/local/host/shell");
        term.open(terminalContainer);
        term.on("data", function (v) {
           console.log('data', v);
        });
        // term.winptyCompatInit();
        // term.webLinksInit();
        term.fit();
        term.focus();
        conn.onopen = runRealTerminal;
        conn.onclose = runRealTerminal;
        conn.onerror = runRealTerminal;
    }

    function runRealTerminal() {
        // console.log(term);
        // FIXME: attach is sending single character to server one at a time, it is not waiting for \n
        term.attach(conn, true, true);
    }

</script>
</body>
</html>
